<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spotify Token Generator</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .step { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .code { background: #000; color: #0f0; padding: 10px; border-radius: 3px; font-family: monospace; }
        button { background: #1db954; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #1ed760; }
        input { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>ðŸŽµ Spotify Token Generator</h1>
    
    <div class="step">
        <h3>Step 1: Get Your Spotify App Credentials</h3>
        <p>Go to <a href="https://developer.spotify.com/dashboard" target="_blank">Spotify Developer Dashboard</a></p>
        <p>Create a new app or use existing one</p>
        <p>Copy your <strong>Client ID</strong> and <strong>Client Secret</strong></p>
    </div>

    <div class="step">
        <h3>Step 2: Enter Your Credentials</h3>
        <input type="text" id="clientId" placeholder="Your Spotify Client ID">
        <input type="text" id="clientSecret" placeholder="Your Spotify Client Secret">
        <button onclick="generateAuthUrl()">Generate Authorization URL</button>
    </div>

    <div class="step" id="authStep" style="display: none;">
        <h3>Step 3: Authorize Your App</h3>
        <p>Click the button below to authorize your Spotify account:</p>
        <button id="authButton" onclick="authorizeSpotify()">Authorize Spotify</button>
        <p><strong>Important:</strong> After authorization, you'll be redirected to your portfolio site. Copy the URL from your browser's address bar.</p>
    </div>

    <div class="step" id="tokenStep" style="display: none;">
        <h3>Step 4: Get Your Tokens</h3>
        <p>Paste the full redirect URL here (it should contain a "code" parameter):</p>
        <input type="text" id="redirectUrl" placeholder="https://subham12r.netlify.app/callback?code=YOUR_CODE_HERE">
        <button onclick="exchangeCode()">Get Tokens</button>
        <div id="tokens" style="display: none;">
            <h4>âœ… Your Tokens (Add these to your .env file):</h4>
            <div class="code" id="tokenOutput"></div>
        </div>
    </div>

    <script>
        let clientId, clientSecret;

        function generateAuthUrl() {
            clientId = document.getElementById('clientId').value;
            clientSecret = document.getElementById('clientSecret').value;
            
            if (!clientId || !clientSecret) {
                alert('Please enter both Client ID and Client Secret');
                return;
            }

            const scopes = [
                'user-read-currently-playing',
                'user-read-recently-played',
                'user-read-playback-state'
            ].join(' ');

            const authUrl = `https://accounts.spotify.com/authorize?` +
                `client_id=${clientId}&` +
                `response_type=code&` +
                `redirect_uri=${encodeURIComponent('https://portfolio-bice-beta-a4ejdfdsaj.vercel.app/callback')}&` +
                `scope=${encodeURIComponent(scopes)}&` +
                `show_dialog=true`;

            document.getElementById('authButton').onclick = () => {
                window.open(authUrl, '_blank');
            };

            document.getElementById('authStep').style.display = 'block';
            document.getElementById('tokenStep').style.display = 'block';
        }

        async function exchangeCode() {
            const redirectUrl = document.getElementById('redirectUrl').value;
            const urlParams = new URLSearchParams(redirectUrl.split('?')[1]);
            const code = urlParams.get('code');

            if (!code) {
                alert('Invalid URL. Make sure it contains a "code" parameter');
                return;
            }

            try {
                const response = await fetch('https://accounts.spotify.com/api/token', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'Authorization': `Basic ${btoa(`${clientId}:${clientSecret}`)}`
                    },
                    body: new URLSearchParams({
                        grant_type: 'authorization_code',
                        code: code,
                        redirect_uri: 'https://portfolio-bice-beta-a4ejdfdsaj.vercel.app/callback'
                    })
                });

                const data = await response.json();

                if (data.error) {
                    alert('Error: ' + data.error_description);
                    return;
                }

                const expiresAt = Date.now() + (data.expires_in * 1000);
                
                const envVars = `SPOTIFY_CLIENT_ID=${clientId}
SPOTIFY_CLIENT_SECRET=${clientSecret}
SPOTIFY_ACCESS_TOKEN=${data.access_token}
SPOTIFY_REFRESH_TOKEN=${data.refresh_token}
SPOTIFY_TOKEN_EXPIRES_AT=${expiresAt}`;

                document.getElementById('tokenOutput').textContent = envVars;
                document.getElementById('tokens').style.display = 'block';

                // Copy to clipboard
                navigator.clipboard.writeText(envVars).then(() => {
                    alert('âœ… Tokens copied to clipboard! Add them to your .env file.');
                });

            } catch (error) {
                alert('Error: ' + error.message);
            }
        }
    </script>
</body>
</html>
